
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Azure-powered real-time voice agent with text-to-speech and speech recognition capabilities" name="description"/>
<link href="../llm-orchestration/" rel="prev"/>
<link href="../data-flows/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.23" name="generator"/>
<title>ACS Flows - Real-Time Voice Agent Documentation</title>
<link href="../../assets/stylesheets/main.84d31ad4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../assets/_mkdocstrings.css" rel="stylesheet"/>
<link href="../../assets/oad-styles.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="light-blue" data-md-color-primary="blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#acs-call-automation-media-flows">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Real-Time Voice Agent Documentation" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Real-Time Voice Agent Documentation">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Real-Time Voice Agent Documentation
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              ACS Flows
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="light-blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="light-blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/Azure-Samples/art-voice-agent-accelerator/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    Azure-Samples/art-voice-agent-accelerator
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../getting-started/">
          
  
  
  Getting Started

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../">
          
  
  
  Architecture

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../deployment/">
          
  
  
  Deployment

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../security/authentication/">
          
  
  
  Security

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../operations/monitoring/">
          
  
  
  Operations

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../api/">
          
  
  
  API Reference

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../industry/healthcare/">
          
  
  
  Industry Solutions

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../samples/">
          
  
  
  Samples &amp; Labs

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../guides/repository-structure/">
          
  
  
  Guides

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Real-Time Voice Agent Documentation" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Real-Time Voice Agent Documentation">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Real-Time Voice Agent Documentation
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/Azure-Samples/art-voice-agent-accelerator/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    Azure-Samples/art-voice-agent-accelerator
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Getting Started
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/">
<span class="md-ellipsis">
    Quick Start Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/local-development/">
<span class="md-ellipsis">
    Local Development
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/configuration/">
<span class="md-ellipsis">
    Configuration Guide
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
<span class="md-ellipsis">
    Architecture
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../llm-orchestration/">
<span class="md-ellipsis">
    LLM Orchestration
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    ACS Flows
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    ACS Flows
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#acs-call-automation-media-flows">
<span class="md-ellipsis">
      ACS Call Automation &amp; Media Flows
    </span>
</a>
<nav aria-label="ACS Call Automation &amp; Media Flows" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#azure-communication-services-integration">
<span class="md-ellipsis">
      Azure Communication Services Integration
    </span>
</a>
<nav aria-label="Azure Communication Services Integration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#speech-recognition-capabilities">
<span class="md-ellipsis">
      Speech Recognition Capabilities
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#three-thread-processing-architecture">
<span class="md-ellipsis">
      Three-Thread Processing Architecture
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#thread-responsibilities-communication">
<span class="md-ellipsis">
      Thread Responsibilities &amp; Communication
    </span>
</a>
<nav aria-label="Thread Responsibilities &amp; Communication" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#core-design-principles">
<span class="md-ellipsis">
      Core Design Principles
    </span>
</a>
<nav aria-label="Core Design Principles" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#speech-sdk-thread-never-blocks">
<span class="md-ellipsis">
      ğŸ¤ Speech SDK Thread - Never Blocks
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#route-turn-thread-blocks-only-on-queue">
<span class="md-ellipsis">
      ğŸ”„ Route Turn Thread - Blocks Only on Queue
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#main-event-loop-never-blocks">
<span class="md-ellipsis">
      ğŸŒ Main Event Loop - Never Blocks
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#thread-performance-matrix">
<span class="md-ellipsis">
      Thread Performance Matrix
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#implementation-flow">
<span class="md-ellipsis">
      Implementation Flow
    </span>
</a>
<nav aria-label="Implementation Flow" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#barge-in-detection-and-handling">
<span class="md-ellipsis">
      Barge-in Detection and Handling
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-components">
<span class="md-ellipsis">
      Key Components
    </span>
</a>
<nav aria-label="Key Components" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#threadbridge">
<span class="md-ellipsis">
      ThreadBridge
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#speechsdkthread">
<span class="md-ellipsis">
      SpeechSDKThread
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#routeturnthread">
<span class="md-ellipsis">
      RouteTurnThread
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#maineventloop">
<span class="md-ellipsis">
      MainEventLoop
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#non-blocking-thread-communication-sequence">
<span class="md-ellipsis">
      ğŸ”„ Non-Blocking Thread Communication Sequence
    </span>
</a>
<nav aria-label="ğŸ”„ Non-Blocking Thread Communication Sequence" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#critical-non-blocking-characteristics">
<span class="md-ellipsis">
      ğŸš€ Critical Non-Blocking Characteristics
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-implementation-details">
<span class="md-ellipsis">
      Key Implementation Details
    </span>
</a>
<nav aria-label="Key Implementation Details" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#barge-in-detection">
<span class="md-ellipsis">
      ğŸš¨ Barge-In Detection
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#async-background-task-management">
<span class="md-ellipsis">
      ğŸ”„ Async Background Task Management
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stop-audio-signal-protocol">
<span class="md-ellipsis">
      ğŸ›‘ Stop Audio Signal Protocol
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-handling-resilience">
<span class="md-ellipsis">
      âš¡ Error Handling &amp; Resilience
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-optimizations">
<span class="md-ellipsis">
      ğŸ“Š Performance Optimizations
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../data-flows/">
<span class="md-ellipsis">
    Data Flows
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../speech-recognition/">
<span class="md-ellipsis">
    Speech Recognition
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../speech-synthesis/">
<span class="md-ellipsis">
    Speech Synthesis
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../streaming-modes/">
<span class="md-ellipsis">
    Streaming Modes
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../integrations/">
<span class="md-ellipsis">
    Integrations
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Deployment
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../deployment/">
<span class="md-ellipsis">
    Deployment Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../deployment/production/">
<span class="md-ellipsis">
    Production
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../deployment/cicd/">
<span class="md-ellipsis">
    CI/CD
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Security
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Security
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../security/authentication/">
<span class="md-ellipsis">
    Authentication
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Operations
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Operations
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../operations/monitoring/">
<span class="md-ellipsis">
    Monitoring
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operations/troubleshooting/">
<span class="md-ellipsis">
    Troubleshooting
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operations/testing/">
<span class="md-ellipsis">
    Testing
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operations/load-testing/">
<span class="md-ellipsis">
    Load Testing
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-ellipsis">
    API Reference
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/api-reference/">
<span class="md-ellipsis">
    API Reference
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
<span class="md-ellipsis">
    Industry Solutions
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            Industry Solutions
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../industry/healthcare/">
<span class="md-ellipsis">
    Healthcare
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_9" type="checkbox"/>
<label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
<span class="md-ellipsis">
    Samples &amp; Labs
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_9_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_9">
<span class="md-nav__icon md-icon"></span>
            Samples &amp; Labs
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_10" type="checkbox"/>
<label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
<span class="md-ellipsis">
    Guides
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_10_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_10">
<span class="md-nav__icon md-icon"></span>
            Guides
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/repository-structure/">
<span class="md-ellipsis">
    Repository Structure
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/utilities/">
<span class="md-ellipsis">
    Utilities &amp; Services
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#acs-call-automation-media-flows">
<span class="md-ellipsis">
      ACS Call Automation &amp; Media Flows
    </span>
</a>
<nav aria-label="ACS Call Automation &amp; Media Flows" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#azure-communication-services-integration">
<span class="md-ellipsis">
      Azure Communication Services Integration
    </span>
</a>
<nav aria-label="Azure Communication Services Integration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#speech-recognition-capabilities">
<span class="md-ellipsis">
      Speech Recognition Capabilities
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#three-thread-processing-architecture">
<span class="md-ellipsis">
      Three-Thread Processing Architecture
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#thread-responsibilities-communication">
<span class="md-ellipsis">
      Thread Responsibilities &amp; Communication
    </span>
</a>
<nav aria-label="Thread Responsibilities &amp; Communication" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#core-design-principles">
<span class="md-ellipsis">
      Core Design Principles
    </span>
</a>
<nav aria-label="Core Design Principles" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#speech-sdk-thread-never-blocks">
<span class="md-ellipsis">
      ğŸ¤ Speech SDK Thread - Never Blocks
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#route-turn-thread-blocks-only-on-queue">
<span class="md-ellipsis">
      ğŸ”„ Route Turn Thread - Blocks Only on Queue
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#main-event-loop-never-blocks">
<span class="md-ellipsis">
      ğŸŒ Main Event Loop - Never Blocks
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#thread-performance-matrix">
<span class="md-ellipsis">
      Thread Performance Matrix
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#implementation-flow">
<span class="md-ellipsis">
      Implementation Flow
    </span>
</a>
<nav aria-label="Implementation Flow" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#barge-in-detection-and-handling">
<span class="md-ellipsis">
      Barge-in Detection and Handling
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-components">
<span class="md-ellipsis">
      Key Components
    </span>
</a>
<nav aria-label="Key Components" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#threadbridge">
<span class="md-ellipsis">
      ThreadBridge
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#speechsdkthread">
<span class="md-ellipsis">
      SpeechSDKThread
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#routeturnthread">
<span class="md-ellipsis">
      RouteTurnThread
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#maineventloop">
<span class="md-ellipsis">
      MainEventLoop
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#non-blocking-thread-communication-sequence">
<span class="md-ellipsis">
      ğŸ”„ Non-Blocking Thread Communication Sequence
    </span>
</a>
<nav aria-label="ğŸ”„ Non-Blocking Thread Communication Sequence" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#critical-non-blocking-characteristics">
<span class="md-ellipsis">
      ğŸš€ Critical Non-Blocking Characteristics
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-implementation-details">
<span class="md-ellipsis">
      Key Implementation Details
    </span>
</a>
<nav aria-label="Key Implementation Details" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#barge-in-detection">
<span class="md-ellipsis">
      ğŸš¨ Barge-In Detection
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#async-background-task-management">
<span class="md-ellipsis">
      ğŸ”„ Async Background Task Management
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#stop-audio-signal-protocol">
<span class="md-ellipsis">
      ğŸ›‘ Stop Audio Signal Protocol
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-handling-resilience">
<span class="md-ellipsis">
      âš¡ Error Handling &amp; Resilience
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-optimizations">
<span class="md-ellipsis">
      ğŸ“Š Performance Optimizations
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1>ACS Flows</h1>
<h2 id="acs-call-automation-media-flows"><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M15 12h2a5 5 0 0 0-5-5v2a3 3 0 0 1 3 3m4 0h2c0-5-4.03-9-9-9v2c3.86 0 7 3.13 7 7m1 3.5c-1.25 0-2.45-.2-3.57-.57-.35-.11-.74-.03-1.02.25l-2.2 2.2a15.1 15.1 0 0 1-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02A11.4 11.4 0 0 1 8.5 4a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1 17 17 0 0 0 17 17 1 1 0 0 0 1-1v-3.5a1 1 0 0 0-1-1"></path></svg></span> ACS Call Automation &amp; Media Flows<a class="headerlink" href="#acs-call-automation-media-flows" title="Permanent link">Â¶</a></h2>
<div class="admonition abstract">
<p class="admonition-title">Three-Thread Voice Processing Architecture</p>
<p>Comprehensive architecture for Azure Communication Services (ACS) media handling, specifically designed for <strong>real-time voice processing</strong> with integrated <strong>barge-in detection</strong> capabilities.</p>
</div>
<h3 id="azure-communication-services-integration"><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13.05 4.24 6.56 18.05 2 18l5.09-8.76zm.7 1.09L22 19.76H6.74l9.3-1.66-4.87-5.79z"></path></svg></span> Azure Communication Services Integration<a class="headerlink" href="#azure-communication-services-integration" title="Permanent link">Â¶</a></h3>
<div class="admonition success">
<p class="admonition-title">Enterprise Voice Processing</p>
<p>Azure Speech SDK provides continuous speech recognition optimized for real-time conversations with sub-10ms barge-in detection.</p>
</div>
<h4 id="speech-recognition-capabilities"><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a3 3 0 0 1 3 3v6a3 3 0 0 1-3 3 3 3 0 0 1-3-3V5a3 3 0 0 1 3-3m7 9c0 3.53-2.61 6.44-6 6.93V21h-2v-3.07c-3.39-.49-6-3.4-6-6.93h2a5 5 0 0 0 5 5 5 5 0 0 0 5-5z"></path></svg></span> Speech Recognition Capabilities<a class="headerlink" href="#speech-recognition-capabilities" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h5.5c-.3.8-.5 1.6-.5 2.5 0 3.6 2.9 6.5 6.5 6.5.8 0 1.5-.1 2.1-.4L20 15zm-.7-11.1c.4-.7.7-1.5.7-2.4C20 4 18 2 15.5 2S11 4 11 6.5s2 4.5 4.5 4.5c.9 0 1.7-.3 2.4-.7l3.1 3.1 1.4-1.4zm-3.8.1C14.1 9 13 7.9 13 6.5S14.1 4 15.5 4 18 5.1 18 6.5 16.9 9 15.5 9"></path></svg></span> Feature</th>
<th><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 9h-2V7h2m0 10h-2v-6h2m-1-9A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2"></path></svg></span> Description</th>
<th><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 16a3 3 0 0 1-3-3c0-1.12.61-2.1 1.5-2.61l9.71-5.62-5.53 9.58c-.5.98-1.51 1.65-2.68 1.65m0-13c1.81 0 3.5.5 4.97 1.32l-2.1 1.21C14 5.19 13 5 12 5a8 8 0 0 0-8 8c0 2.21.89 4.21 2.34 5.65h.01c.39.39.39 1.02 0 1.41s-1.03.39-1.42.01A9.97 9.97 0 0 1 2 13 10 10 0 0 1 12 3m10 10c0 2.76-1.12 5.26-2.93 7.07-.39.38-1.02.38-1.41-.01a.996.996 0 0 1 0-1.41A7.95 7.95 0 0 0 20 13c0-1-.19-2-.54-2.9L20.67 8C21.5 9.5 22 11.18 22 13"></path></svg></span> Accelerator Focus</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Real-time Processing</strong></td>
<td>Immediate partial and final result processing</td>
<td>Low-latency patterns</td>
</tr>
<tr>
<td><strong>Barge-in Detection</strong></td>
<td>Advanced voice activity detection for interruptions</td>
<td>Reference implementation</td>
</tr>
<tr>
<td><strong>Multiple Result Types</strong></td>
<td>Partial results for speed, final results for accuracy</td>
<td>Flexible processing modes</td>
</tr>
<tr>
<td><strong>Session Management</strong></td>
<td>Automatic session handling with connection recovery</td>
<td>Robust connection patterns</td>
</tr>
<tr>
<td><strong>Continuous Recognition</strong></td>
<td>Persistent speech-to-text processing</td>
<td>24/7 operation templates</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">Microsoft Learn Resources</p>
<ul>
<li><strong><a href="https://learn.microsoft.com/en-us/azure/communication-services/how-tos/call-automation/audio-streaming-quickstart">Audio Streaming Quickstart</a></strong> - Server-side audio streaming implementation</li>
<li><strong><a href="https://learn.microsoft.com/en-us/azure/communication-services/quickstarts/call-automation/callflows-for-customer-interactions">Call Automation SDK</a></strong> - Automated call routing solutions</li>
<li><strong><a href="https://learn.microsoft.com/en-us/azure/communication-services/concepts/voice-video-calling/media-access">Media Access Overview</a></strong> - Real-time media stream processing patterns</li>
<li><strong><a href="https://learn.microsoft.com/en-us/azure/ai-services/speech-service/speech-to-text">Speech to Text Service</a></strong> - Real-time speech recognition capabilities</li>
<li><strong><a href="https://learn.microsoft.com/en-us/azure/ai-services/speech-service/get-started-speech-to-text">Real-time Speech Recognition</a></strong> - Implementation patterns for continuous STT processing</li>
<li><strong><a href="https://learn.microsoft.com/en-us/azure/communication-services/concepts/call-automation/audio-streaming-concept">Bidirectional Audio Streaming</a></strong> - Two-way media streaming architecture</li>
<li><strong><a href="https://learn.microsoft.com/en-us/azure/communication-services/how-tos/call-automation/audio-streaming-quickstart#handling-audio-streams-in-your-websocket-server">WebSocket Audio Processing</a></strong> - Real-time audio stream handling patterns</li>
</ul>
</div>
<h3 id="three-thread-processing-architecture"><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9 2v6h2v3H5c-1.11 0-2 .89-2 2v3H1v6h6v-6H5v-3h6v3H9v6h6v-6h-2v-3h6v3h-2v6h6v-6h-2v-3c0-1.11-.89-2-2-2h-6V8h2V2z"></path></svg></span> Three-Thread Processing Architecture<a class="headerlink" href="#three-thread-processing-architecture" title="Permanent link">Â¶</a></h3>
<div class="admonition tip">
<p class="admonition-title">Thread Separation Strategy</p>
<p>The architecture separates concerns across three dedicated threads for optimal performance and reliability.</p>
</div>
<div class="mermaid">graph TB
    subgraph SpeechSDK["ğŸ¤ Speech SDK Thread"]
        A1["Continuous Audio Recognition"]
        A2["on_partial â†’ Barge-in Detection"]
        A3["on_final â†’ Queue Speech Result"]
        A1 --&gt; A2
        A1 --&gt; A3
    end

    subgraph RouteLoop["ğŸ”„ Route Turn Thread"]
        B1["await speech_queue.get()"]
        B2["Orchestrator Processing"]
        B3["TTS Generation &amp; Playback"]
        B1 --&gt; B2 --&gt; B3
    end

    subgraph MainLoop["ğŸŒ Main Event Loop"]
        C1["WebSocket Media Handler"]
        C2["Barge-in Response"]
        C3["Task Cancellation"]
        C1 --&gt; C2 --&gt; C3
    end

    %% Cross-thread communication
    A2 -.-&gt;|"run_coroutine_threadsafe"| C2
    A3 -.-&gt;|"queue.put_nowait"| B1
    B3 -.-&gt;|"Task Reference"| C1
    C2 -.-&gt;|"cancel()"| B2

    classDef speechStyle fill:#9B59B6,stroke:#6B3E99,stroke-width:2px,color:#FFFFFF
    classDef routeStyle fill:#FF6B35,stroke:#E55100,stroke-width:2px,color:#FFFFFF
    classDef mainStyle fill:#4A90E2,stroke:#2E5C8A,stroke-width:2px,color:#FFFFFF

    class A1,A2,A3 speechStyle
    class B1,B2,B3 routeStyle
    class C1,C2,C3 mainStyle
</div>
<h3 id="thread-responsibilities-communication">Thread Responsibilities &amp; Communication<a class="headerlink" href="#thread-responsibilities-communication" title="Permanent link">Â¶</a></h3>
<h4 id="core-design-principles">Core Design Principles<a class="headerlink" href="#core-design-principles" title="Permanent link">Â¶</a></h4>
<p>The three-thread architecture follows these key principles:</p>
<h5 id="speech-sdk-thread-never-blocks">ğŸ¤ <strong>Speech SDK Thread</strong> - Never Blocks<a class="headerlink" href="#speech-sdk-thread-never-blocks" title="Permanent link">Â¶</a></h5>
<ul>
<li><strong>Continuous audio recognition</strong> using Azure Speech SDK</li>
<li><strong>Immediate barge-in detection</strong> via <code>on_partial</code> callbacks</li>
<li><strong>Cross-thread communication</strong> via <code>run_coroutine_threadsafe</code></li>
<li><strong>Performance</strong>: &lt; 10ms response time for barge-in detection</li>
</ul>
<h5 id="route-turn-thread-blocks-only-on-queue">ğŸ”„ <strong>Route Turn Thread</strong> - Blocks Only on Queue<a class="headerlink" href="#route-turn-thread-blocks-only-on-queue" title="Permanent link">Â¶</a></h5>
<ul>
<li><strong>AI processing and response generation</strong> through orchestrator</li>
<li><strong>Queue-based serialization</strong> of conversation turns</li>
<li><strong>Safe cancellation</strong> without affecting speech recognition</li>
<li><strong>Performance</strong>: Processes one turn at a time, can be cancelled</li>
</ul>
<h5 id="main-event-loop-never-blocks">ğŸŒ <strong>Main Event Loop</strong> - Never Blocks<a class="headerlink" href="#main-event-loop-never-blocks" title="Permanent link">Â¶</a></h5>
<ul>
<li><strong>WebSocket handling</strong> for real-time media streaming</li>
<li><strong>Task cancellation</strong> for barge-in scenarios</li>
<li><strong>Non-blocking coordination</strong> between threads</li>
<li><strong>Performance</strong>: &lt; 50ms for task cancellation and stop commands</li>
</ul>
<h4 id="thread-performance-matrix">Thread Performance Matrix<a class="headerlink" href="#thread-performance-matrix" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>Thread</th>
<th>Primary Role</th>
<th>Blocking Behavior</th>
<th>Barge-in Role</th>
<th>Response Time</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Speech SDK</strong></td>
<td>Audio recognition</td>
<td>âŒ Never blocks</td>
<td>âœ… Detection</td>
<td>&lt; 10ms</td>
</tr>
<tr>
<td><strong>Route Turn</strong></td>
<td>AI processing</td>
<td>âœ… Queue operations only</td>
<td>âŒ None</td>
<td>Variable</td>
</tr>
<tr>
<td><strong>Main Event</strong></td>
<td>WebSocket &amp; coordination</td>
<td>âŒ Never blocks</td>
<td>âœ… Execution</td>
<td>&lt; 50ms</td>
</tr>
</tbody>
</table>
<h3 id="implementation-flow">Implementation Flow<a class="headerlink" href="#implementation-flow" title="Permanent link">Â¶</a></h3>
<h4 id="barge-in-detection-and-handling">Barge-in Detection and Handling<a class="headerlink" href="#barge-in-detection-and-handling" title="Permanent link">Â¶</a></h4>
<ol>
<li><strong>User speaks during AI response</strong>:</li>
<li><code>on_partial()</code> callback fires immediately (&lt; 10ms)</li>
<li><code>ThreadBridge.schedule_barge_in()</code> schedules handler on main event loop</li>
<li>
<p><code>MainEventLoop.handle_barge_in()</code> cancels current processing</p>
</li>
<li>
<p><strong>Task cancellation chain</strong>:
   <div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>on_partial() â†’ schedule_barge_in() â†’ cancel_current_processing() â†’ send_stop_audio()
</span></code></pre></div></p>
</li>
<li>
<p><strong>Speech finalization</strong>:</p>
</li>
<li><code>on_final()</code> callback queues completed speech via <code>ThreadBridge.queue_speech_result()</code></li>
<li><code>RouteTurnThread</code> picks up speech from queue</li>
<li>New AI processing task created for response generation</li>
</ol>
<h4 id="key-components">Key Components<a class="headerlink" href="#key-components" title="Permanent link">Â¶</a></h4>
<h5 id="threadbridge">ThreadBridge<a class="headerlink" href="#threadbridge" title="Permanent link">Â¶</a></h5>
<p>Provides thread-safe communication between Speech SDK Thread and Main Event Loop:
- <code>schedule_barge_in()</code> - Schedules barge-in handler execution
- <code>queue_speech_result()</code> - Queues final speech for processing
- Uses <code>run_coroutine_threadsafe</code> and <code>asyncio.Queue</code> for safe cross-thread communication</p>
<h5 id="speechsdkthread">SpeechSDKThread<a class="headerlink" href="#speechsdkthread" title="Permanent link">Â¶</a></h5>
<p>Manages Speech SDK in dedicated background thread:
- Pre-initializes <code>push_stream</code> to prevent audio data loss
- Never blocks on AI processing or network operations
- Provides immediate callback execution for barge-in detection</p>
<h5 id="routeturnthread">RouteTurnThread<a class="headerlink" href="#routeturnthread" title="Permanent link">Â¶</a></h5>
<p>Handles AI processing in isolated thread:
- Blocks only on <code>speech_queue.get()</code> operations
- Processes speech through orchestrator
- Creates and manages TTS playback tasks</p>
<h5 id="maineventloop">MainEventLoop<a class="headerlink" href="#maineventloop" title="Permanent link">Â¶</a></h5>
<p>Coordinates WebSocket operations and task management:
- Handles incoming media messages and audio data
- Manages barge-in interruption and task cancellation
- Never blocks to ensure real-time responsiveness</p>
<h3 id="non-blocking-thread-communication-sequence">ğŸ”„ Non-Blocking Thread Communication Sequence<a class="headerlink" href="#non-blocking-thread-communication-sequence" title="Permanent link">Â¶</a></h3>
<div class="mermaid">sequenceDiagram
    participant SpeechSDK as ğŸ§µ Speech SDK Thread
    participant MainLoop as ğŸ§µ Main Event Loop
    participant RouteLoop as ğŸ§µ Route Turn Thread  
    participant ACS as ğŸ”Š Azure Communication Services
    participant User as ğŸ‘¤ User

    Note over SpeechSDK,User: ğŸµ AI Currently Playing Audio
    MainLoop-&gt;&gt;ACS: ğŸ”Š Streaming TTS Audio Response
    ACS-&gt;&gt;User: ğŸµ Audio Playback Active

    rect rgba(255, 149, 0, 0.15)
    Note over SpeechSDK,User: ğŸš¨ USER SPEAKS (BARGE-IN EVENT)
    User-&gt;&gt;SpeechSDK: ğŸ—£ï¸ Audio Input (Partial Recognition)

    Note right of SpeechSDK: âš¡ IMMEDIATE ACTION<br/>ğŸš« NO BLOCKING
    SpeechSDK-&gt;&gt;SpeechSDK: ğŸ” on_partial() callback triggered
    end

    rect rgba(255, 59, 48, 0.2)
    Note over SpeechSDK,MainLoop: ğŸ”— CROSS-THREAD COMMUNICATION
    SpeechSDK--&gt;&gt;MainLoop: ğŸš€ run_coroutine_threadsafe(_handle_barge_in_async)
    Note right of SpeechSDK: âœ… Speech thread continues<br/> NOT BLOCKED

    Note over MainLoop: ğŸ›‘ BARGE-IN HANDLER EXECUTES
    MainLoop-&gt;&gt;MainLoop: âŒ playback_task.cancel()
    MainLoop-&gt;&gt;MainLoop: ğŸ§¹ Clear route_turn_queue
    MainLoop-&gt;&gt;ACS: ğŸ›‘ Send StopAudio command
    end

    rect rgba(52, 199, 89, 0.15)
    ACS--&gt;&gt;User: ğŸ”‡ Audio Playback STOPPED
    Note right of MainLoop: âœ… Previous AI response<br/>cancelled cleanly
    end

    rect rgba(0, 122, 255, 0.1)
    Note over SpeechSDK,RouteLoop: ğŸ“ USER CONTINUES SPEAKING
    User-&gt;&gt;SpeechSDK: ğŸ—£ï¸ Continues Speaking
    SpeechSDK-&gt;&gt;SpeechSDK:  on_final() callback triggered

    Note over SpeechSDK,MainLoop: ğŸ”— FINAL RESULT COMMUNICATION
    SpeechSDK--&gt;&gt;MainLoop:  run_coroutine_threadsafe(_handle_final_async)
    MainLoop-&gt;&gt;MainLoop:  route_turn_queue.put(final_text)
    Note right of SpeechSDK: âœ… Speech thread continues<br/>ğŸš« NOT BLOCKED
    end

    rect rgba(102, 51, 153, 0.1)
    Note over RouteLoop,ACS: ğŸ¤– NEW AI PROCESSING
    RouteLoop-&gt;&gt;RouteLoop: ğŸ“¥ queue.get() receives final_text
    Note right of RouteLoop: â³ ONLY thread that blocks<br/>ğŸ¯ Dedicated AI processing

    RouteLoop-&gt;&gt;MainLoop: ğŸµ Create new playback_task
    MainLoop-&gt;&gt;ACS: ğŸ”Š Send New TTS Response
    ACS-&gt;&gt;User: ğŸµ Play New AI Response
    end

    Note over SpeechSDK,User: âœ… COMPLETE NON-BLOCKING CYCLE
</div>
<h4 id="critical-non-blocking-characteristics">ğŸš€ Critical Non-Blocking Characteristics<a class="headerlink" href="#critical-non-blocking-characteristics" title="Permanent link">Â¶</a></h4>
<table>
<thead>
<tr>
<th>Event</th>
<th>Thread Source</th>
<th>Target Thread</th>
<th>Blocking?</th>
<th>Communication Method</th>
<th>Response Time</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ğŸš¨ Barge-in Detection</strong></td>
<td>Speech SDK</td>
<td>Main Event Loop</td>
<td>âŒ NO</td>
<td><code>run_coroutine_threadsafe</code></td>
<td>&lt; 10ms</td>
</tr>
<tr>
<td><strong>ğŸ“‹ Final Speech</strong></td>
<td>Speech SDK</td>
<td>Route Turn Thread</td>
<td>âŒ NO</td>
<td><code>asyncio.Queue.put()</code></td>
<td>&lt; 5ms</td>
</tr>
<tr>
<td><strong>ğŸµ AI Processing</strong></td>
<td>Route Turn</td>
<td>Main Event Loop</td>
<td>âŒ NO</td>
<td><code>asyncio.create_task</code></td>
<td>&lt; 1ms</td>
</tr>
<tr>
<td><strong>ğŸ›‘ Task Cancellation</strong></td>
<td>Main Event Loop</td>
<td>Playback Task</td>
<td>âŒ NO</td>
<td><code>task.cancel()</code></td>
<td>&lt; 1ms</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>ğŸ¯ Key Insight</strong>: Only the <strong>Route Turn Thread</strong> blocks (on <code>queue.get()</code>), ensuring Speech SDK and Main Event Loop remain responsive for real-time barge-in detection.</p>
</blockquote>
<hr/>
<h3 id="key-implementation-details">Key Implementation Details<a class="headerlink" href="#key-implementation-details" title="Permanent link">Â¶</a></h3>
<p>This section provides <strong>concrete implementation specifics</strong> for developers working with the ACS Media Handler threading architecture.</p>
<h4 id="barge-in-detection">ğŸš¨ Barge-In Detection<a class="headerlink" href="#barge-in-detection" title="Permanent link">Â¶</a></h4>
<ul>
<li><strong>Trigger</strong>: <code>on_partial</code> callback from Speech Recognizer detects user speech</li>
<li><strong>Immediate Action</strong>: Synchronous cancellation of <code>playback_task</code> using <code>asyncio.Task.cancel()</code></li>
<li><strong>Stop Signal</strong>: Send <code>{"Kind": "StopAudio", "StopAudio": {}}</code> JSON command to ACS via WebSocket</li>
<li><strong>Logging</strong>: Comprehensive logging with emojis for real-time debugging</li>
</ul>
<h4 id="async-background-task-management">ğŸ”„ Async Background Task Management<a class="headerlink" href="#async-background-task-management" title="Permanent link">Â¶</a></h4>
<ul>
<li><strong>Route Turn Queue</strong>: Serializes final speech processing using <code>asyncio.Queue()</code></li>
<li><strong>Playback Task</strong>: Tracks current AI response generation/playback with <code>self.playback_task</code></li>
<li><strong>Task Lifecycle</strong>: Clean creation, cancellation, and cleanup of background tasks</li>
<li><strong>Cancellation Safety</strong>: Proper <code>try/except asyncio.CancelledError</code> handling</li>
</ul>
<h4 id="stop-audio-signal-protocol">ğŸ›‘ Stop Audio Signal Protocol<a class="headerlink" href="#stop-audio-signal-protocol" title="Permanent link">Â¶</a></h4>
<p><div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="p">{</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">  </span><span class="nt">"Kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"StopAudio"</span><span class="p">,</span>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">  </span><span class="nt">"AudioData"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">  </span><span class="nt">"StopAudio"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="p">}</span>
</span></code></pre></div>
This JSON message is sent to ACS to immediately halt any ongoing audio playback.</p>
<h4 id="error-handling-resilience">âš¡ Error Handling &amp; Resilience<a class="headerlink" href="#error-handling-resilience" title="Permanent link">Â¶</a></h4>
<ul>
<li><strong>Event Loop Detection</strong>: Graceful handling when no event loop is available</li>
<li><strong>WebSocket Validation</strong>: Connection state checks before sending messages</li>
<li><strong>Task Cancellation</strong>: Proper cleanup with <code>await task</code> after cancellation</li>
<li><strong>Queue Management</strong>: Full queue detection and message dropping strategies</li>
</ul>
<h4 id="performance-optimizations">ğŸ“Š Performance Optimizations<a class="headerlink" href="#performance-optimizations" title="Permanent link">Â¶</a></h4>
<ul>
<li><strong>Immediate Cancellation</strong>: Barge-in triggers instant playback stop (&lt; 50ms)</li>
<li><strong>Background Processing</strong>: Non-blocking AI response generation</li>
<li><strong>Memory Management</strong>: Proper task cleanup prevents memory leaks</li>
<li><strong>Concurrent Safety</strong>: Thread-safe queue operations for speech processing</li>
</ul>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.highlight", "search.share", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
mermaid.initialize({});</script></body>
</html>