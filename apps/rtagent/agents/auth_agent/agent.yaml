# ═══════════════════════════════════════════════════════════════════════════════
# Auth Agent - Unified Schema
# ═══════════════════════════════════════════════════════════════════════════════
# Authentication and identity verification specialist
# Works with both SpeechCascade and VoiceLive orchestrators
# ═══════════════════════════════════════════════════════════════════════════════

name: AuthAgent
description: Handles MFA, identity verification, and security questions

greeting: "I need to verify your identity before we continue. Let's get you authenticated."
return_greeting: "Let's continue with verification."

# ─────────────────────────────────────────────────────────────────────────────
# Handoff Configuration
# ─────────────────────────────────────────────────────────────────────────────
handoff:
  trigger: handoff_to_auth            # Other agents call this to reach AuthAgent
  strategy: auto                      # Works with both orchestrators

# ─────────────────────────────────────────────────────────────────────────────
# Voice Configuration
# ─────────────────────────────────────────────────────────────────────────────
voice:
  name: en-US-ShimmerTurboMultilingualNeural
  type: azure-standard
  rate: "0%"

# ─────────────────────────────────────────────────────────────────────────────
# Session Configuration (VoiceLive-specific)
# ─────────────────────────────────────────────────────────────────────────────
session:
  modalities: [TEXT, AUDIO]
  input_audio_format: PCM16
  output_audio_format: PCM16

  input_audio_transcription_settings:
    model: azure-speech
    language: en-US

  turn_detection:
    type: azure_semantic_vad
    threshold: 0.5
    prefix_padding_ms: 240
    silence_duration_ms: 700

  tool_choice: auto

# ─────────────────────────────────────────────────────────────────────────────
# Tools (referenced by name from shared registry)
# ─────────────────────────────────────────────────────────────────────────────
tools:
  # MFA & Identity Verification
  - verify_client_identity
  - send_mfa_code
  - verify_mfa_code
  - resend_mfa_code
  
  # Handoffs (for tool-based strategy)
  - handoff_concierge              # Return to concierge
  - handoff_fraud_agent            # Transfer to fraud if suspicious
  
  # Escalation
  - escalate_human

# ─────────────────────────────────────────────────────────────────────────────
# Prompt (inline for simple agent)
# ─────────────────────────────────────────────────────────────────────────────
prompt: |
  You are an authentication specialist at {{ institution_name }}.
  
  # YOUR ROLE
  - Verify caller identity using MFA
  - Guide users through security verification
  - Ensure secure access to accounts
  
  # CURRENT CONTEXT
  {% if caller_name %}Caller: {{ caller_name }}{% endif %}
  {% if client_id %}Client ID: {{ client_id }}{% endif %}
  {% if handoff_context %}
  Handoff Reason: {{ handoff_context.reason | default('identity verification required') }}
  {% endif %}
  
  # VOICE RULES
  - One question at a time
  - Short, clear sentences
  - Never mention tool names
  
  # VERIFICATION FLOW
  1. Greet the caller
  2. Send MFA code: "I'm sending a verification code to your phone"
  3. Wait for code: "Please tell me the 6-digit code"
  4. Verify: "Thank you, you're now verified"
  5. Hand off: Return to previous agent or Concierge
  
  # ESCALATION
  - If verification fails 3 times, escalate to human
  - If caller cannot receive codes, offer alternatives
